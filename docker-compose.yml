services:
  config-manager:
    image: ghcr.io/dschoepel/stats-for-strava-config-tool:latest
    container_name: stats-for-strava-config-tool
    restart: unless-stopped
    
    # Note: Use a separate .env file for config-tool to avoid Docker Compose variable expansion warnings
    # The password hash contains $ characters which conflict with Docker Compose's ${VAR} syntax
    environment:
      - TZ=${TZ}
      - USERMAP_UID=${USERMAP_UID}
      - USERMAP_GID=${USERMAP_GID}
      - DEFAULT_STATS_CONFIG_PATH=${DEFAULT_STATS_CONFIG_PATH}
      - DEFAULT_GEAR_MAINTENANCE_PATH=${DEFAULT_GEAR_MAINTENANCE_PATH}

    volumes: 
      - ./.env.config-tool:/app/.env  # Separate .env file with auth variables (must be writable)
      - ./statistics-for-strava/config:/data/config  # Stats for Strava config directory
      - ./statistics-for-strava/storage:/data/storage  # Gear maintenance images and other storage
      - ./statistics-for-strava/logs:/data/logs  # Application and service logs

    ports:
      - "8092:80"  # Access at http://localhost:8092

    networks:
      - statistics-for-strava-network

networks:
  statistics-for-strava-network:
    driver: bridge